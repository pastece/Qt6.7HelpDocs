<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<!-- finetuning.qdoc -->
  <meta name="description" content="Describes the environment variables available, to control how Javascript is run.">
  <title>Configuring the JavaScript Engine | Qt QML 6.7.0</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");
    // loading style sheet breaks anchors that were jumped to before
    // so force jumping to anchor again
    setTimeout(function() {
        var anchor = location.hash;
        // need to jump to different anchor first (e.g. none)
        location.hash = "#";
        setTimeout(function() {
            location.hash = anchor;
        }, 0);
    }, 0);
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
    <div class="main">
    <div class="main-rounded">
        <div class="navigationbar">
        <ul>
<li><a href="../qtdoc/index.html" translate="no">Qt 6.7</a></li>
<li><a href="qtqml-index.html" translate="no">Qt QML</a></li>
<li>Configuring the JavaScript Engine</li>
<li id="buildversion"><a href="qtqml-index.html" translate="no">Qt 6.7.0 Reference Documentation</a></li>
    </ul>
    </div>
</div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar"><div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">Configuring the JavaScript Engine</h1>
<!-- $$$qtqml-javascript-finetuning.html-description -->
<div class="descr" id="details">
<p>Running JavaScript code can be influenced by a few environment variables, particularly:</p>
<div class="table"><table class="generic">
 <thead><tr class="qt-style"><th >Environment Variable</th><th >Description</th></tr></thead>
<tr valign="top" class="odd"><td ><code translate="no">QV4_JIT_CALL_THRESHOLD</code></td><td >The JavaScript engine contains a Just-In-Time compiler (JIT). The JIT will compile frequently run JavaScript functions into machine code to run faster. This environment variable determines how often a function needs to be run to be considered for JIT compilation. The default value is 3 times.</td></tr>
<tr valign="top" class="even"><td ><code translate="no">QV4_FORCE_INTERPRETER</code></td><td >Setting this environment variable runs all functions and expressions through the interpreter. The JIT is never used, no matter how often a function or expression is called. Functions and expressions may still be compiled ahead of time using <a href="qtqml-tool-qmlcachegen.html" translate="no">qmlcachegen</a> or <a href="qtqml-qml-script-compiler.html" translate="no">qmlsc</a>, but only the generated byte code is used at run time. Any generated C++ code and the machine code resulting from it is ignored.</td></tr>
<tr valign="top" class="odd"><td ><code translate="no">QV4_JS_MAX_STACK_SIZE</code></td><td >The JavaScript engine reserves a special memory area as a stack to run JavaScript. This stack is separate from the C++ stack. Usually this area is 4MB in size. If this environment variable contains a number, the JavaScript engine interprets it as the size of the memory area, in bytes, to be allocated as the JavaScript stack.</td></tr>
<tr valign="top" class="even"><td ><code translate="no">QV4_GC_MAX_STACK_SIZE</code></td><td >In addition to the regular JavaScript stack, the JavaScript engine keeps another stack for the garbage collector, usually 2MB of memory. If the garbage collector needs to handle an excessive number of objects at the same time, this stack might overrun. If it contains a number, this environment variable is interpreted as the size in bytes of the memory area that will be allocated as the stack for the garbage collector.</td></tr>
<tr valign="top" class="odd"><td ><code translate="no">QV4_CRASH_ON_STACKOVERFLOW</code></td><td >Usually the JavaScript engine tries to catch C++ stack overflows caused by excessively recursive JavaScript code, and generates a non-fatal error condition. There are separate recursion checks for compiling JavaScript and running JavaScript. A stack overflow when compiling JavaScript indicates that the code contains deeply nested objects and functions. A stack overflow at run-time indicates that the code results in a deeply recursive program. The check for this is only indirectly related to the JavaScript stack size mentioned above, as each JavaScript function call consumes stack space on both, the C++ and the JavaScript stack. The code that checks for excessive recursion is necessarily conservative, as the available stack size depends on many factors and can often be customized by the user. With this environment variable set, the JavaScript engine does not check for stack overflows when compiling or running JavaScript and will not generate exceptions for them. Instead, when the stack overflows the program attempts an invalid memory access. This most likely terminates the program. In turn, the program gets to use up all the stack space the operating system can provide.<div class="admonition warning">
<p><b>Warning: </b>malicious code may be able to evade the termination and access unexpected memory locations this way.</p>
</div>
</td></tr>
<tr valign="top" class="even"><td ><code translate="no">QV4_MAX_CALL_DEPTH</code></td><td >Stack overflows when running (as opposed to compiling) JavaScript are prevented by controlling the call depth: the number of nested function invocations. By default, an exception is generated if the call depth exceeds a maximum number tuned to the platform's default stack size. If the <code translate="no">QV4_MAX_CALL_DEPTH</code> environment variable contains a number, this number is used as maximum call depth. Beware that the recursion limit when compiling JavaScript is not affected. The default maximum call depth is 1234 on most platforms. On QNX it is 640 because on QNX the default stack size is smaller than on most platforms.</td></tr>
<tr valign="top" class="odd"><td ><code translate="no">QV4_MM_AGGRESSIVE_GC</code></td><td >Setting this environment variable runs the garbage collector before each memory allocation. This is very expensive at run-time, but it quickly uncovers many memory management errors, for example the manual deletion of an object belonging to the QML engine from C++.</td></tr>
<tr valign="top" class="even"><td ><code translate="no">QV4_PROFILE_WRITE_PERF_MAP</code></td><td >On Linux, the <code translate="no">perf</code> utility can be used to profile programs. To analyze JIT-compiled JavaScript functions, it needs to know about their names and locations in memory. To provide this information, there's a convention to create a special file called <code translate="no">perf-&lt;pid&gt;.map</code> in <i>/tmp</i> which perf then reads. This environment variable, if set, causes the JIT to generate this file.</td></tr>
<tr valign="top" class="odd"><td ><code translate="no">QV4_SHOW_BYTECODE</code></td><td >Outputs the IR bytecode generated by Qt to the console. Has to be combined with <code translate="no">QML_DISABLE_DISK_CACHE</code> or already cached bytecode will not be shown.</td></tr>
<tr valign="top" class="even"><td ><code translate="no">QV4_DUMP_BASIC_BLOCKS</code></td><td >Outputs the basic blocks of each function compiled ahead of time. The details of the blocks are printed to the console. Additionally, control flow graphs with the byte code for each block are generated in the DOT format for each compiled function. The value of <code translate="no">QV4_DUMP_BASIC_BLOCKS</code> is used as the path to the folder where the DOT files should be generated. If the path is any of [&quot;-&quot;, &quot;1&quot;, &quot;true&quot;] or if files can't be opened, the graphs are dumped to stdout instead.</td></tr>
<tr valign="top" class="odd"><td ><code translate="no">QV4_VALIDATE_BASIC_BLOCKS</code></td><td >Performs checks on the basic blocks of a function compiled ahead of time to validate its structure and coherence. If the validation fails, an error message is printed to the console.</td></tr>
</table></div>
<p><a href="qmldiskcache.html" translate="no">The QML Disk Cache</a> accepts further environment variables that allow fine tuning its behavior. In particular <code translate="no">QML_DISABLE_DISK_CACHE</code> may be useful for debugging.</p>
</div>
<!-- @@@qtqml-javascript-finetuning.html -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2024 <span translate="no">The Qt Company Ltd.</span>
   Documentation contributions included herein are the copyrights of
   their respective owners.<br/>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the <span translate="no">Free Software Foundation</span>.<br/>    <span translate="no">Qt</span> and respective logos are <a href="https://doc.qt.io/qt/trademarks.html">    trademarks</a> of <span translate="no">The Qt Company Ltd.</span> in Finland and/or other countries
   worldwide. All other trademarks are property of their respective owners. </p>
</div>
</body>
</html>
